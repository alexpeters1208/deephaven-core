<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rdeephaven">
<title>Moving Operations with update_by • rdeephaven</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Moving Operations with update_by">
<meta property="og:description" content="rdeephaven">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rdeephaven</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.31.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/rdeephaven.html">Overview</a>
    <a class="dropdown-item" href="../articles/agg_by.html">Aggregations with agg_by</a>
    <a class="dropdown-item" href="../articles/update_by.html">Moving Operations with update_by</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="update_by_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Moving Operations with update_by</h1>
            
      
      
      <div class="d-none name"><code>update_by.Rmd</code></div>
    </div>

    
    
<p>Deephaven’s <code>update_by()</code> table method and suite of <code>uby</code> functions enable cumulative and moving calculations on static <em>and</em> streaming tables. Complex operations like cumulative minima and maxima, exponential moving averages, and rolling standard deviations are all possible and effortless to execute. As always in Deephaven, the results of these calculations will continue to update as their parent tables are updated. Additionally, it’s easy to group data by one or more columns, enabling complex group-wise calculations with a single line of code.</p>
<div class="section level2">
<h2 id="applying-updateby-operations-to-a-table">Applying UpdateBy operations to a table<a class="anchor" aria-label="anchor" href="#applying-updateby-operations-to-a-table"></a>
</h2>
<p>The table method <code>update_by()</code> is the entry point for UpdateBy operations. It takes two arguments: the first is an <code>UpdateByOp</code> or a list of <code>UpdateByOp</code>s denoting the calculations to perform on specific columns of the table. Then, it takes a column name or a list of column names that define the groups on which to perform the calculations. If you don’t want grouped calculations, omit this argument.</p>
<p>To learn more about UpdateByOps, see the reference documentation with <code><a href="../reference/UpdateByOp.html">?UpdateByOp</a></code>.</p>
<p>The <code>update_by()</code> method itself does not know anything about the columns on which you want to perform calculations. Rather, the desired columns are passed to individual <code>uby</code> functions, enabling a massive amount of flexibility.</p>
</div>
<div class="section level2">
<h2 id="uby-functions">
<code>uby</code> functions<a class="anchor" aria-label="anchor" href="#uby-functions"></a>
</h2>
<p><code>uby</code> functions are the workers that actually execute the complex UpdateBy calculations. These functions are <em>generators</em>, meaning they return <em>functions</em> that the Deephaven engine knows how to interpret. We call the functions they return <code>UpdateByOp</code>s. See <code><a href="../reference/UpdateByOp.html">?UpdateByOp</a></code> for more information. These UpdateByOps are not R-level functions, but Deephaven-specific data types that perform all of the intensive calculations. Here is a list of all <code>uby</code> functions available in Deephaven:</p>
<ul>
<li><code><a href="../reference/uby_cum_min.html">uby_cum_min()</a></code></li>
<li><code><a href="../reference/uby_cum_max.html">uby_cum_max()</a></code></li>
<li><code><a href="../reference/uby_cum_sum.html">uby_cum_sum()</a></code></li>
<li><code><a href="../reference/uby_cum_prod.html">uby_cum_prod()</a></code></li>
<li><code><a href="../reference/uby_forward_fill.html">uby_forward_fill()</a></code></li>
<li><code><a href="../reference/uby_delta.html">uby_delta()</a></code></li>
<li><code><a href="../reference/uby_emmin_tick.html">uby_emmin_tick()</a></code></li>
<li><code><a href="../reference/uby_emmin_time.html">uby_emmin_time()</a></code></li>
<li><code><a href="../reference/uby_emmax_tick.html">uby_emmax_tick()</a></code></li>
<li><code><a href="../reference/uby_emmax_time.html">uby_emmax_time()</a></code></li>
<li><code><a href="../reference/uby_ems_tick.html">uby_ems_tick()</a></code></li>
<li><code><a href="../reference/uby_ems_time.html">uby_ems_time()</a></code></li>
<li><code><a href="../reference/uby_ema_tick.html">uby_ema_tick()</a></code></li>
<li><code><a href="../reference/uby_ema_time.html">uby_ema_time()</a></code></li>
<li><code><a href="../reference/uby_emstd_tick.html">uby_emstd_tick()</a></code></li>
<li><code><a href="../reference/uby_emstd_time.html">uby_emstd_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_count_tick.html">uby_rolling_count_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_count_time.html">uby_rolling_count_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_group_tick.html">uby_rolling_group_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_group_time.html">uby_rolling_group_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_min_tick.html">uby_rolling_min_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_min_time.html">uby_rolling_min_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_max_tick.html">uby_rolling_max_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_max_time.html">uby_rolling_max_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_sum_tick.html">uby_rolling_sum_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_sum_time.html">uby_rolling_sum_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_prod_tick.html">uby_rolling_prod_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_prod_time.html">uby_rolling_prod_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_avg_tick.html">uby_rolling_avg_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_avg_time.html">uby_rolling_avg_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_wavg_tick.html">uby_rolling_wavg_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_wavg_time.html">uby_rolling_wavg_time()</a></code></li>
<li><code><a href="../reference/uby_rolling_std_tick.html">uby_rolling_std_tick()</a></code></li>
<li><code><a href="../reference/uby_rolling_std_time.html">uby_rolling_std_time()</a></code></li>
</ul>
<p>For more details on each aggregation function, see the reference documentation by running <code><a href="../reference/uby_cum_min.html">?uby_cum_min</a></code>, <code><a href="../reference/uby_delta.html">?uby_delta</a></code>, etc.</p>
</div>
<div class="section level2">
<h2 id="an-example">An Example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(rdeephaven)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="co"># connecting to Deephaven server</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>client &lt;-<span class="st"> </span>Client<span class="op">$</span><span class="kw">new</span>(<span class="st">"localhost:10000"</span>, <span class="dt">auth_type =</span> <span class="st">"psk"</span>, <span class="dt">auth_token =</span> <span class="st">"my_secret_token"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="co"># create data frame, push to server, retrieve TableHandle</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  <span class="dt">timeCol =</span> <span class="kw">seq.POSIXt</span>(<span class="kw">as.POSIXct</span>(<span class="kw">Sys.Date</span>()), <span class="kw">as.POSIXct</span>(<span class="kw">Sys.Date</span>() <span class="op">+</span><span class="st"> </span><span class="fl">0.01</span>), <span class="dt">by =</span> <span class="st">"1 sec"</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>],</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  <span class="dt">boolCol =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>), <span class="dv">500</span>, <span class="ot">TRUE</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  <span class="dt">col1 =</span> <span class="kw">sample</span>(<span class="dv">10000</span>, <span class="dt">size =</span> <span class="dv">500</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>  <span class="dt">col2 =</span> <span class="kw">sample</span>(<span class="dv">10000</span>, <span class="dt">size =</span> <span class="dv">500</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  <span class="dt">col3 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">500</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>th &lt;-<span class="st"> </span>client<span class="op">$</span><span class="kw">import_table</span>(df)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a><span class="co"># compute 10-row exponential weighted moving average of col1 and col2, grouped by boolCol</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>th1 &lt;-<span class="st"> </span>th<span class="op">$</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="st">  </span><span class="kw">update_by</span>(<span class="kw">uby_ema_tick</span>(<span class="dt">decay_ticks =</span> <span class="dv">10</span>, <span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"col1Ema = col1"</span>, <span class="st">"col2Ema = col2"</span>)), <span class="dt">by =</span> <span class="st">"boolCol"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a><span class="co"># compute rolling 10-second weighted average and standard deviation of col1 and col2, weighted by col3</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>th2 &lt;-<span class="st"> </span>th<span class="op">$</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a><span class="st">  </span><span class="kw">update_by</span>(</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>  <span class="kw">c</span>(</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>    <span class="kw">uby_rolling_wavg_time</span>(<span class="dt">ts_col =</span> <span class="st">"timeCol"</span>, <span class="dt">wcol =</span> <span class="st">"col3"</span>, <span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"col1WAvg = col1"</span>, <span class="st">"col2WAvg = col2"</span>), <span class="dt">rev_time =</span> <span class="st">"PT10s"</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>    <span class="kw">uby_rolling_std_time</span>(<span class="dt">ts_col =</span> <span class="st">"timeCol"</span>, <span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">"col1Std = col1"</span>, <span class="st">"col2Std = col2"</span>), <span class="dt">rev_time =</span> <span class="st">"PT10s"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>  )</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a><span class="co"># compute cumulative minimum and maximum of col1 and col2 respectively, and the rolling 20-row sum of col3, grouped by boolCol</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>th3 &lt;-<span class="st"> </span>th<span class="op">$</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a><span class="st">  </span><span class="kw">update_by</span>(</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a>  <span class="kw">c</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>    <span class="kw">uby_cum_min</span>(<span class="dt">cols =</span> <span class="st">"col1"</span>),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>    <span class="kw">uby_cum_max</span>(<span class="dt">cols =</span> <span class="st">"col2"</span>),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>    <span class="kw">uby_rolling_sum_tick</span>(<span class="dt">cols =</span> <span class="st">"col3"</span>, <span class="dt">rev_ticks =</span> <span class="dv">20</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>  ),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>  <span class="dt">by =</span> <span class="st">"boolCol"</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>client<span class="op">$</span><span class="kw">close</span>()</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a><span class="er">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alex Peters.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
